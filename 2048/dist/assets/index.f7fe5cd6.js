!function(t=".",i="__import__"){try{self[i]=new Function("u","return import(u)")}catch(s){const e=new URL(t,location),r=t=>{URL.revokeObjectURL(t.src),t.remove()};self[i]=t=>new Promise(((s,c)=>{const h=new URL(t,e);if(self[i].moduleMap[h])return s(self[i].moduleMap[h]);const n=new Blob([`import * as m from '${h}';`,`${i}.moduleMap['${h}']=m;`],{type:"text/javascript"}),o=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(n),onerror(){c(new Error(`Failed to import: ${t}`)),r(o)},onload(){s(self[i].moduleMap[h]),r(o)}});document.head.appendChild(o)})),self[i].moduleMap={}}}("/2048/dist/assets/");function t(t,i,s=10){return t.beginPath(),t.moveTo(t.x+s,t.y),t.lineTo(t.x+i-s,t.y),t.quadraticCurveTo(t.x+i,t.y,t.x+i,t.y+s),t.lineTo(t.x+i,t.y+i-s),t.quadraticCurveTo(t.x+i,t.y+i,t.x+i-s,t.y+i),t.lineTo(t.x+10,t.y+i),t.quadraticCurveTo(t.x,t.y+i,t.x,t.y+i-s),t.lineTo(t.x,t.y+s),t.quadraticCurveTo(t.x,t.y,t.x+s,t.y),t.fill()}const i=function(t,i){const{x:s,y:e,fillStyle:r}=t;i(t),Object.assign(t,{x:s,y:e,fillStyle:r})};class s{constructor(t,i){this.ctx=t,this.sum=i}render(){const i=this.ctx;i.fillStyle=i.theme.brick[this.sum][0],t(i,i.brickWidth),i.fillStyle=i.theme.brick[this.sum][1],i.textAlign="center",i.textBaseline="middle",i.font=i.brickWidth/2+"px sans-serif",i.fillText(String(this.sum),i.x+i.brickWidth/2,i.y+i.brickWidth/2)}}class e{constructor(t,i){this.ctx=t,this.size=i,this.bricks=new Array(i);for(let s=0;s<i;s++)this.bricks[s]=new Array(i);this.seed()}static from(t){const i=function(t){return t.split(/[\n\r|]/).map((t=>(t.trim(),t.split("").map((t=>Number.isNaN(+t)?null:+t)))))}(t),r=new e(null,i.length);for(let e=0;e<i.length;e++)for(let t=0;t<i[0].length;t++)r.bricks[e][t]=i[e][t]?new s(null,i[e][t]):null;return r}toString(){const t=new Array(this.bricks.length);for(let i=0;i<this.bricks.length;i++)t[i]=new Array(this.bricks.length);for(let i=0;i<this.bricks.length;i++)for(let s=0;s<this.bricks.length;s++)t[i][s]=this.bricks[i][s]&&this.bricks[i][s].sum;return function(t){return t.map((t=>t.map((t=>t||".")).join(""))).join("|")}(t)}seed(){const t=[];for(let i=0;i<this.size;i++)for(let s=0;s<this.size;s++)this.bricks[i][s]||t.push([i,s]);if(t.length){const i=Math.round(Math.random()*t.length*100),[e,r]=t[i%t.length];return this.bricks[e][r]=new s(this.ctx,2**(1+i%2)),!0}return!1}compact(t){let i,s,e=!1;do{switch(s=!1,t){case"up":for(let t=0;t<this.size;t++)for(let e=1;e<this.size;e++)this.bricks[t][e]&&!this.bricks[t][e-1]&&(this.bricks[t][e-1]=this.bricks[t][e],this.bricks[t][e]=null,s=i=!0);if(!e)for(let t=0;t<this.size;t++)for(let r=1;r<this.size;r++)this.bricks[t][r]&&this.bricks[t][r-1]&&this.bricks[t][r].sum===this.bricks[t][r-1].sum&&(this.bricks[t][r-1].sum*=2,this.bricks[t][r]=null,s=i=!0,e=!0);break;case"right":for(let t=this.size-2;t>=0;t--)for(let e=0;e<this.size;e++)this.bricks[t][e]&&!this.bricks[t+1][e]&&(this.bricks[t+1][e]=this.bricks[t][e],this.bricks[t][e]=null,s=i=!0);if(!e)for(let t=this.size-2;t>=0;t--)for(let r=0;r<this.size;r++)this.bricks[t][r]&&this.bricks[t+1][r]&&this.bricks[t][r].sum===this.bricks[t+1][r].sum&&(this.bricks[t+1][r].sum*=2,this.bricks[t][r]=null,s=i=!0,e=!0);break;case"down":for(let t=0;t<this.size;t++)for(let e=this.size-2;e>=0;e--)this.bricks[t][e]&&!this.bricks[t][e+1]&&(this.bricks[t][e+1]=this.bricks[t][e],this.bricks[t][e]=null,s=i=!0);if(!e)for(let t=0;t<this.size;t++)for(let r=this.size-2;r>=0;r--)this.bricks[t][r]&&this.bricks[t][r+1]&&this.bricks[t][r].sum===this.bricks[t][r+1].sum&&(this.bricks[t][r+1].sum*=2,this.bricks[t][r]=null,s=i=!0,e=!0);break;case"left":for(let t=1;t<this.size;t++)for(let e=0;e<this.size;e++)this.bricks[t][e]&&!this.bricks[t-1][e]&&(this.bricks[t-1][e]=this.bricks[t][e],this.bricks[t][e]=null,s=i=!0);if(!e)for(let t=1;t<this.size;t++)for(let r=0;r<this.size;r++)this.bricks[t][r]&&this.bricks[t-1][r]&&this.bricks[t][r].sum===this.bricks[t-1][r].sum&&(this.bricks[t-1][r].sum*=2,this.bricks[t][r]=null,s=i=!0,e=!0)}}while(s);return i}render(){const s=this.ctx;this.ctx.fillStyle=s.theme.gridBackground,t(s,s.gridWidth,20),s.fillStyle=s.theme.brickBackground;for(let e=0;e<this.size;e++)for(let r=0;r<this.size;r++)i(s,(()=>{s.x=s.x+e*s.brickWidth+(e+1)*s.brickMargin,s.y=s.y+r*s.brickWidth+(r+1)*s.brickMargin,t(s,s.brickWidth);const i=this.bricks[e][r];i&&i.render()}))}}var r={gridBackground:"#A59482",brickBackground:"#BFAE9E",brick:{2:["#F1E7DF","#736C5F"],4:["#F1E7DF","#736C5F"],8:["#F1B17E","#FFFFFF"],16:["#F7966A","#FFFFFF"],32:["#F47F67","#FFFFFF"],64:["#F75F4F","#FFFFFF"],128:["#EFD697","#FFFFFF"],256:["#F2CC67","#FFFFFF"],512:["#EBC56F","#FFFFFF"],1024:["#EEC351","#FFFFFF"],2048:["#EEC241","#FFFFFF"],4096:["#EEC241","#FFFFFF"]}};const c=new Audio("/2048/dist/assets/bubble.378e5a32.mov");window.addEventListener("load",(()=>{const t=devicePixelRatio,s=document.getElementById("app"),h=s.getContext("2d");h.theme=r,h.x=0,h.y=0;const{width:n,height:o}=s.getBoundingClientRect();h.width=s.width=n*t,h.height=s.height=o*t,h.gridWidth=Math.floor(.8*Math.min(h.width,h.height));h.brickMargin=h.gridWidth/41,h.brickWidth=9*h.brickMargin;const l=new e(h,4);h.x=(h.width-h.gridWidth)/2,h.y=(h.height-h.gridWidth)/2,i(h,(()=>l.render())),function(t){let i=0,s=0,e=!1;document.addEventListener("touchstart",(t=>{if(1===t.touches.length){e=!0;const r=t.touches[0];i=r.clientX,s=r.clientY}else e=!1})),document.addEventListener("touchmove",(t=>t.preventDefault()),{passive:!1}),document.addEventListener("touchend",(r=>{const c=r.changedTouches[0];if(c&&e){const e=c.clientX-i,r=c.clientY-s;Math.abs(e)>10&&Math.abs(e)>Math.abs(r)?t.next(e>0?"right":"left"):Math.abs(r)>10&&Math.abs(e)<Math.abs(r)&&t.next(r>0?"down":"up")}})),document.addEventListener("keyup",(i=>{switch(i.code){case"ArrowUp":t.next("up");break;case"ArrowRight":t.next("right");break;case"ArrowDown":t.next("down");break;case"ArrowLeft":t.next("left")}}))}({next(t){if(l.compact(t)){if(c.play(),!l.seed())throw alert("failed"),Error("exit");l.render()}}})}));
